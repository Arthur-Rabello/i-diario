<a id="user-info-selector" href="#">
  <%= gravatar_image_tag current_user.email, 48, alt: current_user.navigation_display %>
  <%= content_tag :span do -%>
    <%= t('layouts.application.change_profile') %>
    <i class="fa fa-angle-right" aria-hidden="true"></i>
  <% end -%>
</a>

<div id="current-role-selector">
  <%= simple_form_for user, remote: current_user.admin?, url: set_current_role_path, html: { method: :patch, id: "user-role-form" } do |f| %>
    <%= f.hidden_field :id, value: f.object.id %>
    <%= f.hidden_field :teacher_id, value: f.object.teacher_id, class: 'teacher' %>

    <div class="errors-container"></div>

    <div class="user-info">
      <%= gravatar_image_tag current_user.email, 48, alt: current_user.navigation_display %>
    </div>

    <% if current_user.can_use_teacher_profile? && current_user.teacher_profiles.present? %>
      <div id="teacher-profile-field-container" class="project-context">
        <span class="label required"><%= t('layouts.application.classroom') %></span>
        <%= f.input :teacher_profile_id,
          as: :select2,
          elements: teacher_profiles_options,
          input_html: {"data-placeholder" => t('layouts.application.select')},
          label: false,
          wrapper: false,
          width: '100px' %>
      </div>
    <% else %>
    <div id="role-field-container" class="project-context">
      <span class="label required"><%= t('layouts.application.role') %></span>
      <%= f.input :current_user_role_id,
                  as: :select2,
                  elements: user.user_roles.includes(:unity),
                  input_html: {"data-placeholder" => t('layouts.application.select')},
                  label: false,
                  wrapper: false,
                  width: '100px' %>
    </div>

    <div id="unity-field-container" class="project-context" style="<%= 'display: none;'.html_safe unless user_role.role.access_level.in?(['administrator']) %>">
      <span class="label"><%= t('layouts.application.unit') %></span>
      <%= f.input :current_unity_id,
                  as: :select2,
                  elements: current_unities,
                  input_html: {"data-placeholder" => t('layouts.application.select')},
                  label: false,
                  wrapper: false,
                  class: 'administrator' %>
    </div>

    <div id="school-year-field-container" class="project-context"  style="<%= 'display: none;'.html_safe unless user_role.role.access_level.in?(%w(administrator employee teacher)) %>" >
      <span class="label"><%= t('layouts.application.school_year') %></span>
      <%= f.input :current_school_year,
                  as: :select2,
                  elements: current_user_available_years.to_json,
                  input_html: {"data-placeholder" => t('layouts.application.select')},
                  label: false,
                  wrapper: false %>
    </div>

    <div id="classroom-field-container" class="project-context" style="<%= 'display: none;'.html_safe unless user_role.role.access_level.in?(['teacher']) || user_role.role.access_level.in?(%w(administrator employee)) %>">
      <span class="label"><%= t('layouts.application.classroom') %></span>
      <%= f.input :current_classroom_id,
                  as: :select2,
                  elements: current_user_available_classrooms,
                  input_html: {"data-placeholder" => t('layouts.application.select')},
                  class: 'teacher',
                  data: { dropdown: '.project-context .project-selector.classroom' },
                  wrapper: false,
                  label: false %>
    </div>

    <div id="assumed-teacher-field-container" class="project-context" style="<%= ' display: none;'.html_safe unless user_role.role.access_level.in?(%w(administrator employee)) && f.object.current_classroom_id.present? %>">
      <span class="label"><%= t('layouts.application.teacher') %></span>
      <%= f.input :assumed_teacher_id,
                  as: :select2,
                  elements: current_user_available_teachers,
                  input_html: {"data-placeholder" => t('layouts.application.select')},
                  label: false,
                  wrapper: false %>
    </div>

    <div id="discipline-field-container" class="project-context" style="<%= 'display: none;'.html_safe unless user_role.role.access_level.in?(['teacher']) || (user_role.role.access_level.in?(%w(administrator employee)) && f.object.assumed_teacher_id.present?) %>">
      <span class="label"><%= t('layouts.application.discipline') %></span>
      <%= f.input :current_discipline_id,
                  as: :select2,
                  wrapper: false,
                  label: false,
                  elements: current_user_available_disciplines,
                  input_html: {"data-placeholder" => t('layouts.application.select')},
                  class: 'teacher',
                  data: { dropdown: '.project-context .project-selector.discipline' } %>
    </div>
  <% end %>

    <div class="select-role">
      <button type="submit" class="btn btn-sm bg-color-blueDark txt-color-white"><%= t('layouts.application.change_profile') %></button>
      <a class="btn btn-sm bg-color-white txt-color-blueDark role-cancel"><%= t('layouts.application.cancel') %></a>
    </div>
  <% end %>
</div>

<script>
  window.profile = {
      access_level: <%= raw current_user.current_user_role.present? ? "'#{current_user.current_user_role.role.access_level}'" : "null" %>
  };
</script>
